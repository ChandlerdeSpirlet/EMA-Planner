<html>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="https://ema-planner.herokuapp.com/views/ema.png">
  <title>Class Confirmed for {{ student_name }}</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }
    html {
      background-image: linear-gradient(#0095ff, #9ed7ff);
      -webkit-background-size: cover;
      -moz-background-size: cover;
      -o-background-size: cover;
      background-size: cover;
      min-height: 100%;
    }
    h2 {
      color: black;
    }
    p {
      color: black;
    }
    #page-container {
      position: relative;
      min-height: 90vh;
    }
    #content-wrap {
      padding-bottom: 2.5rem;    /* Footer height */
    }
    ul {
      color: black;
    }
    button {
      display: block;
      font-size: 100%;
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      width: 100%;
      padding: 5px;
      height: 60px;
      align-content: center;
      background-color: transparent;
      border: 1px solid black;
    }
    button {
      width: 60%;
      margin: 0 auto;
    }
</style>
<body>
  {% if num_events == '1' %}
    <meta name="num_events" content="1"/>
    <meta name="month_num" content="{{ classes[0].month_num }}"/>
    <meta name="day_num" content="{{ classes[0].day_num }}"/>
    <meta name="hour_num" content="{{ classes[0].hour_num }}"/>
    <meta name="min_num" content="{{ classes[0].min_num }}"/>
    <meta name="end_hour" content="{{ classes[0].end_hour }}"/>
    <meta name="end_min" content="{{ classes[0].end_min }}"/>
    <meta name="email" content="{{ email[0].email }}"/>
    <meta name="student_name" content="{{ student_name }}"/>
  {% endif %}
  <div id="page-container">
    <div id="content-wrap">
      <h2>{{ student_name }} is signed up for the following classes: </h2>
      <ul>
        {% if classes %}
          {% for class in classes %}
            <li>{{ class.class_instance }}</li>
          {% endfor %}
        {% endif %}
      </ul>
      <p style="text-emphasis: large;">If you need to take your name off of the list for any particular class, please use the tool on the app under the in-person class signup tab. You can lookup all of your classes using the email: <strong>{{ email[0].email }}</strong></p>
      <p>(This page will return to the class signup page in 5 seconds.)</p>
    </div>
    <a href="https://ema-planner.herokuapp.com/student_classes"><button type="button">All Done</button></a><br>
    <button type="button" onclick="javascript: addAlert()" disabled>Add to Calendar</button>
  </div>
</body>
</html>
<script>
  function addAlert(){
    const ics = require('ics');
    var num_events = document.getElementsByName('num_events')[0].content;
    var month_num = document.getElementsByName('month_num')[0].content;
    var day_num = document.getElementsByName('day_num')[0].content;
    var hour_num = document.getElementsByName('hour_num')[0].content;
    var min_num = document.getElementsByName('min_num')[0].content;
    var end_hour = document.getElementsByName('end_hour')[0].content;
    var end_min = document.getElementsByName('end_min')[0].content;
    var email = document.getElementsByName('email')[0].content;
    var student_name = document.getElementsByName('student_name')[0].content;
    alarms = [];
    alarms.push({
      action: 'audio',
      trigger: {hours:2,minutes:30,before:true},
      repeat: 2,
      attachType:'VALUE=URI',
      attach: 'Glass',

    })
    const {error, value} = ics.createEvents([
      {
        title: student_name + "'s Karate Class",
        start: [2021, month_num, day_num, hour_num, min_num],
        end: [2021, month_num, day_num, end_hour, end_min],
        url: 'https://ema-planner.herokuapp.com/classes_email/' + email,
        busyStatus: 'BUSY',
        status: 'CONFIRMED',
        location: 'Exclusive Martial Arts'
      }
    ])
    if (error){
      console.log("Error creating calendar events: " + error);
      alert('ERROR: ' + error);
    }
  }
</script>